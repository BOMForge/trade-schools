<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Trade Schools Map | Complete Edition</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/papaparse@5.3.0/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f1419;
            color: #e1e8ed;
            height: 100vh;
            display: flex;
        }
        
        #map {
            flex: 1;
            height: 100vh;
            background: #1a1f2e;
        }
        
        #sidebar {
            width: 400px;
            background: #192734;
            display: flex;
            flex-direction: column;
            border-left: 1px solid #38444d;
            overflow: hidden;
        }
        
        .header {
            padding: 20px;
            background: linear-gradient(135deg, #15202b 0%, #1a2937 100%);
            border-bottom: 1px solid #38444d;
        }
        
        .header h1 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #1d9bf0 0%, #4ea3ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat {
            background: #253341;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1d9bf0;
        }
        
        .stat-label {
            font-size: 10px;
            color: #8899a6;
            text-transform: uppercase;
            margin-top: 2px;
        }
        
        .controls {
            padding: 15px 20px;
            background: #1a2632;
            border-bottom: 1px solid #38444d;
        }
        
        .search-box {
            width: 100%;
            padding: 10px 12px;
            background: #253341;
            border: 1px solid #38444d;
            border-radius: 8px;
            color: #e1e8ed;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #1d9bf0;
            box-shadow: 0 0 0 3px rgba(29, 155, 240, 0.1);
        }
        
        .filter-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .filter-select {
            flex: 1;
            padding: 8px;
            background: #253341;
            border: 1px solid #38444d;
            border-radius: 6px;
            color: #e1e8ed;
            font-size: 13px;
        }
        
        .view-modes {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .mode-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px 12px;
            background: #253341;
            border: 1px solid #38444d;
            border-radius: 6px;
            color: #8899a6;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .mode-btn:hover {
            background: #2d3c4d;
            color: #e1e8ed;
        }
        
        .mode-btn.active {
            background: #1d9bf0;
            color: white;
            border-color: #1d9bf0;
        }
        
        .mode-icon {
            font-size: 14px;
        }
        
        .schools-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        
        .school-card {
            background: #253341;
            border: 1px solid #38444d;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .school-card:hover {
            background: #2d3c4d;
            transform: translateX(4px);
            border-color: #1d9bf0;
        }
        
        .school-card.selected {
            background: #2d3c4d;
            border-color: #1d9bf0;
            box-shadow: 0 0 0 1px #1d9bf0;
        }
        
        .school-name {
            font-weight: 600;
            color: #e1e8ed;
            margin-bottom: 6px;
            font-size: 15px;
        }
        
        .school-location {
            font-size: 12px;
            color: #8899a6;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .school-website {
            font-size: 12px;
            margin-bottom: 10px;
        }
        
        .school-website a {
            color: #1d9bf0;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .school-website a:hover {
            text-decoration: underline;
        }
        
        .program-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .program-tag {
            padding: 3px 8px;
            background: #1d9bf0;
            color: white;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        /* Custom Leaflet styles */
        .leaflet-popup-content-wrapper {
            background: #15202b;
            border: 1px solid #38444d;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }
        
        .leaflet-popup-content {
            margin: 12px;
            color: #e1e8ed;
            min-width: 250px;
        }
        
        .leaflet-popup-tip {
            background: #15202b;
            border: 1px solid #38444d;
        }
        
        .popup-header {
            font-size: 16px;
            font-weight: 600;
            color: #1d9bf0;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #38444d;
        }
        
        .popup-row {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
            font-size: 13px;
        }
        
        .popup-icon {
            font-size: 14px;
        }
        
        .popup-website {
            color: #1d9bf0;
            text-decoration: none;
        }
        
        .popup-website:hover {
            text-decoration: underline;
        }
        
        .popup-programs {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #38444d;
        }
        
        .popup-programs-title {
            font-size: 12px;
            font-weight: 600;
            color: #8899a6;
            text-transform: uppercase;
            margin-bottom: 6px;
        }
        
        .popup-program-list {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        
        .popup-program {
            padding: 2px 6px;
            background: rgba(29, 155, 240, 0.2);
            border: 1px solid #1d9bf0;
            color: #1d9bf0;
            border-radius: 10px;
            font-size: 11px;
        }
        
        .no-results {
            text-align: center;
            color: #8899a6;
            padding: 40px 20px;
            font-size: 14px;
        }
        
        .loading {
            text-align: center;
            color: #8899a6;
            padding: 40px 20px;
        }
        
        .spinner {
            border: 3px solid #38444d;
            border-top: 3px solid #1d9bf0;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Marker cluster styles */
        .marker-cluster-small {
            background-color: rgba(29, 155, 240, 0.6);
        }
        .marker-cluster-small div {
            background-color: rgba(29, 155, 240, 0.8);
        }
        .marker-cluster-medium {
            background-color: rgba(255, 165, 0, 0.6);
        }
        .marker-cluster-medium div {
            background-color: rgba(255, 165, 0, 0.8);
        }
        .marker-cluster-large {
            background-color: rgba(255, 69, 0, 0.6);
        }
        .marker-cluster-large div {
            background-color: rgba(255, 69, 0, 0.8);
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div id="sidebar">
        <div class="header">
            <h1>üéì Trade Schools Map</h1>
            <div class="stats">
                <div class="stat" onclick="zoomToFullMap()" style="cursor: pointer;" title="Click to zoom out to full map">
                    <div class="stat-value" id="totalSchools">0</div>
                    <div class="stat-label">Total Schools</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="visibleSchools">0</div>
                    <div class="stat-label">Visible</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="programCount">0</div>
                    <div class="stat-label">Programs</div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <input type="text" class="search-box" id="searchBox" placeholder="üîç Search schools...">
            <div class="filter-group">
                <select class="filter-select" id="stateFilter">
                    <option value="">All States</option>
                </select>
                <select class="filter-select" id="programFilter">
                    <option value="">All Programs</option>
                </select>
            </div>
            <div class="view-modes">
                <div class="mode-btn active" id="clustersMode" onclick="setViewMode('clusters')">
                    <span class="mode-icon">üîó</span>
                    <span>Clusters</span>
                </div>
                <div class="mode-btn" id="heatmapMode" onclick="setViewMode('heatmap')">
                    <span class="mode-icon">üå°Ô∏è</span>
                    <span>Heatmap</span>
                </div>
                <div class="mode-btn" id="hexgridMode" onclick="setViewMode('hexgrid')">
                    <span class="mode-icon">üî∑</span>
                    <span>Hex Grid</span>
                </div>
            </div>
        </div>
        
        <div class="schools-list" id="schoolsList">
            <div class="loading">
                <div class="spinner"></div>
                <div>Loading schools data...</div>
            </div>
        </div>
    </div>
    
    <script>
        // Initialize map
        const map = L.map('map', {
            center: [39.8283, -98.5795],
            zoom: 5,
            minZoom: 3,
            maxZoom: 18
        });
        
        // Add dark tile layer
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '¬© OpenStreetMap contributors ¬© CARTO',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);
        
        // Data storage
        let allSchools = [];
        let filteredSchools = [];
        let schoolMarkers = {};
        let markerCluster;
        let heatmapLayer;
        let hexLayer;
        let currentViewMode = 'clusters';
        
        // Program colors
        const programColors = {
            'Welding': '#ff5959',
            'HVAC': '#4ea3ff',
            'Construction': '#ffa84d',
            'Diesel & Automotive Tech': '#3cb371',
            'Electronics': '#f7e35b',
            'CAD/CAM Drafting': '#b084f7',
            'Plumbing & Pipefitting': '#00CED1',
            'Woodworking & Carpentry': '#8B4513',
            'Machine & Mechanical Systems': '#9370DB'
        };
        
        // Get program color
        function getProgramColor(program) {
            if (!program) return '#666666';
            
            for (const [key, color] of Object.entries(programColors)) {
                if (program.toLowerCase().includes(key.toLowerCase()) || 
                    key.toLowerCase().includes(program.toLowerCase())) {
                    return color;
                }
            }
            return '#666666';
        }
        
        // Load all data
        async function loadData() {
            try {
                // First load geocoded data
                const geoResponse = await fetch('schools/trade_schools_geocoded_fixed.csv');
                const geoText = await geoResponse.text();
                const geoData = Papa.parse(geoText, { header: true }).data;
                
                // Then load matchmaking data for programs and websites
                const matchResponse = await fetch('schools/matchmaking_index.csv');
                const matchText = await matchResponse.text();
                const matchData = Papa.parse(matchText, { header: true }).data;
                
                // Also try to load curated data for additional info
                const curatedResponse = await fetch('schools/trade_schools_curated.csv');
                const curatedText = await curatedResponse.text();
                const curatedData = Papa.parse(curatedText, { header: true }).data;
                
                processData(geoData, matchData, curatedData);
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('schoolsList').innerHTML = 
                    '<div class="no-results">Error loading data. Please check console.</div>';
            }
        }
        
        // Process and merge data
        function processData(geoData, matchData, curatedData) {
            // Create lookup for programs and websites from matchmaking data
            const schoolInfo = {};
            matchData.forEach(row => {
                if (!row['Institution Name']) return;
                
                const key = `${row['Institution Name']}_${row.State}_${row.City}`;
                if (!schoolInfo[key]) {
                    schoolInfo[key] = {
                        programs: new Set(),
                        website: row.Website || '',
                        email: row['Contact Email'] || ''
                    };
                }
                if (row.program) {
                    schoolInfo[key].programs.add(row.program);
                }
            });
            
            // Create lookup for curated data
            const curatedInfo = {};
            curatedData.forEach(row => {
                if (!row.institution_name) return;
                
                const state = row['location_parsed.state'] || '';
                const city = row['location_parsed.city'] || '';
                const key = `${row.institution_name}_${state}_${city}`;
                
                curatedInfo[key] = {
                    website: row.website || '',
                    phone: row.phone || '',
                    programs: row.programs ? row.programs.split('|').map(p => p.trim()) : []
                };
            });
            
            // Process geocoded schools
            allSchools = [];
            geoData.forEach(row => {
                if (row.geocoded === 'True' && row.lat && row.lon) {
                    const name = row['Institution Name'];
                    const state = row.State;
                    const city = row.City;
                    const key = `${name}_${state}_${city}`;
                    
                    // Get info from matchmaking data
                    const matchInfo = schoolInfo[key] || { programs: new Set(), website: '', email: '' };
                    
                    // Get info from curated data
                    const curatedKey = `${name}_${state}_${city}`;
                    const cInfo = curatedInfo[curatedKey] || {};
                    
                    // Combine programs from both sources
                    let programs = Array.from(matchInfo.programs);
                    if (cInfo.programs && cInfo.programs.length > 0) {
                        programs = [...new Set([...programs, ...cInfo.programs])];
                    }
                    
                    // Use website from either source (prefer curated if available)
                    let website = cInfo.website || matchInfo.website || '';
                    
                    // Clean up website URL
                    if (website) {
                        website = website.replace(/\/$/, ''); // Remove trailing slash
                        if (!website.startsWith('http') && website.length > 0) {
                            website = 'https://' + website;
                        }
                    }
                    
                    allSchools.push({
                        name: name,
                        state: state,
                        city: city,
                        lat: parseFloat(row.lat),
                        lon: parseFloat(row.lon),
                        programs: programs,
                        website: website,
                        email: matchInfo.email,
                        phone: cInfo.phone || ''
                    });
                }
            });
            
            console.log(`Loaded ${allSchools.length} schools with data`);
            
            // Initialize
            filteredSchools = [...allSchools];
            populateFilters();
            updateStats();
            displayMarkers();
            displaySchoolsList();
        }
        
        // Populate filter dropdowns
        function populateFilters() {
            const states = new Set();
            const programs = new Set();
            
            allSchools.forEach(school => {
                states.add(school.state);
                school.programs.forEach(p => programs.add(p));
            });
            
            // State filter
            const stateFilter = document.getElementById('stateFilter');
            Array.from(states).sort().forEach(state => {
                const option = document.createElement('option');
                option.value = state;
                option.textContent = state;
                stateFilter.appendChild(option);
            });
            
            // Program filter
            const programFilter = document.getElementById('programFilter');
            Array.from(programs).sort().forEach(program => {
                const option = document.createElement('option');
                option.value = program;
                option.textContent = program;
                programFilter.appendChild(option);
            });
            
            // Update program count
            document.getElementById('programCount').textContent = programs.size;
        }
        
        // Set view mode
        function setViewMode(mode) {
            currentViewMode = mode;
            
            // Update UI
            document.getElementById('clustersMode').classList.toggle('active', mode === 'clusters');
            document.getElementById('heatmapMode').classList.toggle('active', mode === 'heatmap');
            document.getElementById('hexgridMode').classList.toggle('active', mode === 'hexgrid');
            
            displayMarkers();
        }
        
        // Display markers on map based on current view mode
        function displayMarkers() {
            // Clear existing layers
            if (markerCluster) map.removeLayer(markerCluster);
            if (heatmapLayer) map.removeLayer(heatmapLayer);
            if (hexLayer) map.removeLayer(hexLayer);
            
            switch(currentViewMode) {
                case 'clusters':
                    renderClusters();
                    break;
                case 'heatmap':
                    renderHeatmap();
                    break;
                case 'hexgrid':
                    renderHexgrid();
                    break;
            }
        }
        
        // Render clusters view
        function renderClusters() {
            // Create marker cluster group
            markerCluster = L.markerClusterGroup({
                chunkedLoading: true,
                showCoverageOnHover: false,
                maxClusterRadius: 50
            });
            
            // Add markers
            filteredSchools.forEach(school => {
                const marker = L.circleMarker([school.lat, school.lon], {
                    radius: 6,
                    fillColor: getProgramColor(school.programs[0]),
                    color: 'white',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.8
                });
                
                // Format website for display
                let websiteDisplay = '';
                if (school.website) {
                    const cleanUrl = school.website.replace(/^https?:\/\//, '');
                    websiteDisplay = `
                        <div class="popup-row">
                            <span class="popup-icon">üåê</span>
                            <a href="${school.website}" target="_blank" class="popup-website">${cleanUrl}</a>
                        </div>
                    `;
                }
                
                // Format programs
                let programsHtml = '';
                if (school.programs.length > 0) {
                    programsHtml = `
                        <div class="popup-programs">
                            <div class="popup-programs-title">Programs</div>
                            <div class="popup-program-list">
                                ${school.programs.map(p => 
                                    `<span class="popup-program">${p}</span>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }
                
                // Create popup content
                const popupContent = `
                    <div class="popup-header">${school.name}</div>
                    <div class="popup-row">
                        <span class="popup-icon">üìç</span>
                        <span>${school.city}, ${school.state}</span>
                    </div>
                    ${websiteDisplay}
                    ${school.phone ? `
                        <div class="popup-row">
                            <span class="popup-icon">üìû</span>
                            <span>${school.phone}</span>
                        </div>
                    ` : ''}
                    ${programsHtml}
                `;
                
                marker.bindPopup(popupContent);
                
                marker.on('click', function() {
                    selectSchool(school);
                });
                
                schoolMarkers[school.name] = marker;
                markerCluster.addLayer(marker);
            });
            
            map.addLayer(markerCluster);
        }
        
        // Render heatmap view
        function renderHeatmap() {
            const heatPoints = filteredSchools.map(school => [school.lat, school.lon, 1]);
            
            heatmapLayer = L.heatLayer(heatPoints, {
                radius: 25,
                blur: 15,
                maxZoom: 10,
                gradient: {
                    0.0: '#001122',
                    0.2: '#004488',
                    0.4: '#0088ff',
                    0.6: '#00ffcc',
                    0.8: '#ffff00',
                    1.0: '#ff0000'
                }
            });
            
            map.addLayer(heatmapLayer);
        }
        
        // Render hexgrid view (simplified version)
        function renderHexgrid() {
            // For now, we'll use a simple grid overlay
            // In a full implementation, you'd use H3 or similar hexagon library
            hexLayer = L.layerGroup();
            
            // Create a simple grid of circles to represent hexagons
            const gridSize = 0.5; // degrees
            const bounds = map.getBounds();
            
            for (let lat = bounds.getSouth(); lat < bounds.getNorth(); lat += gridSize) {
                for (let lon = bounds.getWest(); lon < bounds.getEast(); lon += gridSize) {
                    const schoolsInArea = filteredSchools.filter(school => 
                        Math.abs(school.lat - lat) < gridSize/2 && 
                        Math.abs(school.lon - lon) < gridSize/2
                    );
                    
                    if (schoolsInArea.length > 0) {
                        const hex = L.circle([lat, lon], {
                            radius: 20000, // 20km radius
                            fillColor: getProgramColor(schoolsInArea[0].programs[0]),
                            color: 'white',
                            weight: 2,
                            opacity: 0.8,
                            fillOpacity: 0.6
                        });
                        
                        hex.bindPopup(`
                            <div style="padding: 8px;">
                                <strong>${schoolsInArea.length} schools</strong><br>
                                ${schoolsInArea.slice(0, 3).map(s => s.name).join('<br>')}
                                ${schoolsInArea.length > 3 ? `<br>...and ${schoolsInArea.length - 3} more` : ''}
                            </div>
                        `);
                        
                        hexLayer.addLayer(hex);
                    }
                }
            }
            
            map.addLayer(hexLayer);
        }
        
        // Display schools list
        function displaySchoolsList() {
            const container = document.getElementById('schoolsList');
            
            if (filteredSchools.length === 0) {
                container.innerHTML = '<div class="no-results">No schools found matching your criteria</div>';
                return;
            }
            
            container.innerHTML = filteredSchools.map(school => {
                // Format website for display
                let websiteHtml = '';
                if (school.website) {
                    const cleanUrl = school.website.replace(/^https?:\/\//, '');
                    websiteHtml = `
                        <div class="school-website">
                            <a href="${school.website}" target="_blank">
                                <span>üåê</span>
                                <span>${cleanUrl}</span>
                            </a>
                        </div>
                    `;
                }
                
                return `
                    <div class="school-card" data-name="${school.name}" onclick="selectSchool('${school.name}')">
                        <div class="school-name">${school.name}</div>
                        <div class="school-location">
                            <span>üìç</span>
                            <span>${school.city}, ${school.state}</span>
                        </div>
                        ${websiteHtml}
                        ${school.programs.length > 0 ? `
                            <div class="program-tags">
                                ${school.programs.slice(0, 5).map(p => 
                                    `<span class="program-tag" style="background: ${getProgramColor(p)};">${p}</span>`
                                ).join('')}
                                ${school.programs.length > 5 ? 
                                    `<span class="program-tag" style="background: #666;">+${school.programs.length - 5}</span>` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }
        
        // Select school
        function selectSchool(schoolName) {
            // If schoolName is an object, extract the name
            const name = typeof schoolName === 'string' ? schoolName : schoolName.name;
            
            const school = filteredSchools.find(s => s.name === name);
            if (!school) return;
            
            // Update selected state in sidebar
            document.querySelectorAll('.school-card').forEach(card => {
                card.classList.remove('selected');
            });
            const card = document.querySelector(`[data-name="${name}"]`);
            if (card) {
                card.classList.add('selected');
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            // Center map on school
            map.setView([school.lat, school.lon], 12);
            
            // Open popup
            if (schoolMarkers[name]) {
                schoolMarkers[name].openPopup();
            }
        }
        
        // Update stats
        function updateStats() {
            document.getElementById('totalSchools').textContent = allSchools.length;
            document.getElementById('visibleSchools').textContent = filteredSchools.length;
        }
        
        // Apply filters
        function applyFilters() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const stateFilter = document.getElementById('stateFilter').value;
            const programFilter = document.getElementById('programFilter').value;
            
            filteredSchools = allSchools.filter(school => {
                // Search filter
                if (searchTerm && !school.name.toLowerCase().includes(searchTerm) && 
                    !school.city.toLowerCase().includes(searchTerm)) {
                    return false;
                }
                
                // State filter
                if (stateFilter && school.state !== stateFilter) {
                    return false;
                }
                
                // Program filter
                if (programFilter && !school.programs.includes(programFilter)) {
                    return false;
                }
                
                return true;
            });
            
            updateStats();
            displayMarkers();
            displaySchoolsList();
            
            // Auto-center map to show filtered schools
            if (filteredSchools.length > 0) {
                const bounds = L.latLngBounds(filteredSchools.map(s => [s.lat, s.lon]));
                map.fitBounds(bounds, { padding: [50, 50] });
            }
        }
        
        // Zoom to full map view
        function zoomToFullMap() {
            if (allSchools.length > 0) {
                const bounds = L.latLngBounds(allSchools.map(s => [s.lat, s.lon]));
                map.fitBounds(bounds, { padding: [50, 50] });
            }
        }
        
        // Event listeners
        document.getElementById('searchBox').addEventListener('input', applyFilters);
        document.getElementById('stateFilter').addEventListener('change', applyFilters);
        document.getElementById('programFilter').addEventListener('change', applyFilters);
        
        // Initialize
        loadData();
    </script>
</body>
</html>
