<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Dynamic SEO Meta Tags -->
    <title id="page-title">Trade School Details | BOMForge</title>
    <meta name="description" id="page-description" content="Find detailed information about trade schools, programs, and career opportunities.">
    <meta name="keywords" id="page-keywords" content="trade school, vocational training, career education, technical programs">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" id="og-url" content="">
    <meta property="og:title" id="og-title" content="">
    <meta property="og:description" id="og-description" content="">
    <meta property="og:image" id="og-image" content="">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" id="twitter-url" content="">
    <meta property="twitter:title" id="twitter-title" content="">
    <meta property="twitter:description" id="twitter-description" content="">
    <meta property="twitter:image" id="twitter-image" content="">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="robots" content="index, follow">
    <meta name="author" content="BOMForge">
    <meta name="language" content="en-US">
    <meta name="geo.region" content="US">
    <meta name="geo.placename" content="United States">
    
    <!-- Schema.org structured data for breadcrumbs -->
    <script type="application/ld+json" id="breadcrumb-structured-data">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Home",
                "item": "https://bomforge.com/index.html"
            },
            {
                "@type": "ListItem",
                "position": 2,
                "name": "Trade Schools Map",
                "item": "https://bomforge.com/map.html"
            },
            {
                "@type": "ListItem",
                "position": 3,
                "name": "School Details",
                "item": ""
            }
        ]
    }
    </script>
    
    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://www.google.com">
    <link rel="preconnect" href="https://www.googletagmanager.com">
    
    <!-- DNS prefetch for performance -->
    <link rel="dns-prefetch" href="//unpkg.com">
    <link rel="dns-prefetch" href="//www.google.com">
    <link rel="dns-prefetch" href="//www.googletagmanager.com">
    
    <!-- Structured Data -->
    <script type="application/ld+json" id="structured-data">
    {
        "@context": "https://schema.org",
        "@type": "EducationalOrganization",
        "name": "",
        "description": "",
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "",
            "addressLocality": "",
            "addressRegion": "",
            "postalCode": "",
            "addressCountry": "US"
        },
        "telephone": "",
        "url": "",
        "sameAs": []
    }
    </script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-460P8JXLJ4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-460P8JXLJ4');
    </script>
    
    <!-- Leaflet for Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Papa Parse for CSV -->
    <script src="https://unpkg.com/papaparse@5.3.0/papaparse.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        .header {
            background: #15202b;
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #1d9bf0;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background 0.2s;
        }
        
        .nav-link:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .back-link {
            background: #1d9bf0;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
            transition: background 0.2s;
        }
        
        .back-link:hover {
            background: #0d7bb8;
        }
        
        /* Main Content */
        .main-content {
            padding: 40px 0;
        }
        
        .school-header {
            background: white;
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .school-name {
            font-size: 2.5rem;
            font-weight: bold;
            color: #15202b;
            margin-bottom: 10px;
            line-height: 1.2;
        }
        
        .school-location {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .location-icon {
            width: 20px;
            height: 20px;
            fill: #1d9bf0;
        }
        
        .school-description {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #444;
            margin-bottom: 30px;
        }
        
        .contact-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .contact-icon {
            width: 24px;
            height: 24px;
            fill: #1d9bf0;
        }
        
        .contact-text {
            font-weight: 500;
        }
        
        .contact-link {
            color: #1d9bf0;
            text-decoration: none;
        }
        
        .contact-link:hover {
            text-decoration: underline;
        }
        
        /* Programs Section */
        .programs-section {
            background: white;
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .section-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: #15202b;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-icon {
            width: 28px;
            height: 28px;
            fill: #1d9bf0;
        }
        
        .programs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .program-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .program-card:hover {
            border-color: #1d9bf0;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(29, 155, 240, 0.15);
        }
        
        .program-name {
            font-size: 1.1rem;
            font-weight: bold;
            color: #15202b;
            margin-bottom: 8px;
        }
        
        .program-description {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* Map Section */
        .map-section {
            background: white;
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .map-container {
            height: 400px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #e9ecef;
        }
        
        /* Related Schools */
        .related-section {
            background: white;
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .related-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .related-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        .related-name {
            font-weight: bold;
            color: #15202b;
            margin-bottom: 8px;
        }
        
        .related-location {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .related-programs {
            color: #1d9bf0;
            font-size: 0.9rem;
        }
        
        /* Footer */
        .footer {
            background: #15202b;
            color: white;
            padding: 40px 0;
            text-align: center;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .footer-section h3 {
            color: #1d9bf0;
            margin-bottom: 15px;
        }
        
        .footer-section a {
            color: #ccc;
            text-decoration: none;
            display: block;
            margin-bottom: 8px;
        }
        
        .footer-section a:hover {
            color: #1d9bf0;
        }
        
        .footer-bottom {
            border-top: 1px solid #38444d;
            padding-top: 20px;
            color: #888;
        }
        
        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1d9bf0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Error State */
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .school-header,
            .programs-section,
            .map-section,
            .related-section {
                padding: 25px;
            }
            
            .school-name {
                font-size: 2rem;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .nav-links {
                justify-content: center;
            }
        }
        
        /* Breadcrumb */
        .breadcrumb {
            background: white;
            padding: 15px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .breadcrumb-content {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .breadcrumb a {
            color: #1d9bf0;
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .breadcrumb-separator {
            color: #ccc;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">BOMForge</div>
                <nav class="nav-links">
                    <a href="index.html" class="nav-link">Home</a>
                    <a href="index.html" class="nav-link" id="mapLink">Map</a>
                    <a href="employer-hiring.html" class="nav-link">For Employers</a>
                    <a href="submit-school.html" class="nav-link">Submit School</a>
                </nav>
            </div>
        </div>
    </header>
    
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <div class="container">
            <div class="breadcrumb-content">
                <a href="index.html">Home</a>
                <span class="breadcrumb-separator">></span>
                <a href="index.html" id="breadcrumbMapLink">Trade Schools Map</a>
                <span class="breadcrumb-separator">></span>
                <span id="breadcrumb-school">School Details</span>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Loading State -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Loading school information...</p>
            </div>
            
            <!-- Error State -->
            <div id="error" class="error" style="display: none;">
                <h3>School Not Found</h3>
                <p>We couldn't find the school you're looking for. Please check the URL or return to the <a href="index.html">map</a>.</p>
            </div>
            
            <!-- School Content -->
            <div id="school-content" style="display: none;">
                <!-- School Header -->
                <section class="school-header">
                    <h1 id="school-name" class="school-name">School Name</h1>
                    <div id="school-location" class="school-location">
                        <svg class="location-icon" viewBox="0 0 24 24">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                        <span id="location-text">City, State</span>
                    </div>
                    <div id="school-description" class="school-description">
                        <!-- Description will be populated here -->
                    </div>
                    
                    <!-- Contact Information -->
                    <div class="contact-info">
                        <div id="phone-contact" class="contact-item" style="display: none;">
                            <svg class="contact-icon" viewBox="0 0 24 24">
                                <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                            </svg>
                            <div>
                                <div class="contact-text">Phone</div>
                                <a id="phone-link" href="#" class="contact-link"></a>
                            </div>
                        </div>
                        
                        <div id="email-contact" class="contact-item" style="display: none;">
                            <svg class="contact-icon" viewBox="0 0 24 24">
                                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                            </svg>
                            <div>
                                <div class="contact-text">Email</div>
                                <a id="email-link" href="#" class="contact-link"></a>
                            </div>
                        </div>
                        
                        <div id="website-contact" class="contact-item" style="display: none;">
                            <svg class="contact-icon" viewBox="0 0 24 24">
                                <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
                            </svg>
                            <div>
                                <div class="contact-text">Website</div>
                                <a id="website-link" href="#" class="contact-link" target="_blank" rel="noopener"></a>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Programs Section -->
                <section class="programs-section">
                    <h2 class="section-title">
                        <svg class="section-icon" viewBox="0 0 24 24">
                            <path d="M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82zM12 3L1 9l11 6 9-4.91V17h2V9L12 3z"/>
                        </svg>
                        Programs Offered
                    </h2>
                    <div id="programs-grid" class="programs-grid">
                        <!-- Programs will be populated here -->
                    </div>
                </section>
                
                <!-- Map Section -->
                <section class="map-section">
                    <h2 class="section-title">
                        <svg class="section-icon" viewBox="0 0 24 24">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                        Location
                    </h2>
                    <div id="map-container" class="map-container"></div>
                </section>
                
                <!-- Related Schools -->
                <section class="related-section">
                    <h2 class="section-title">
                        <svg class="section-icon" viewBox="0 0 24 24">
                            <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A1.5 1.5 0 0 0 18.54 7H16.5c-.8 0-1.54.5-1.85 1.26L12.5 14H15v8h2v-6h2v6h2zM12.5 11.5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5S11 9.17 11 10s.67 1.5 1.5 1.5zM5.5 6c1.11 0 2-.89 2-2s-.89-2-2-2-2 .89-2 2 .89 2 2 2zm2 16v-7H9V9.5C9 8.12 7.88 7 6.5 7S4 8.12 4 9.5V15H5.5v7h2z"/>
                        </svg>
                        Similar Schools in the Area
                    </h2>
                    <div id="related-grid" class="related-grid">
                        <!-- Related schools will be populated here -->
                    </div>
                </section>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>BOMForge</h3>
                    <p>Connecting students with quality trade schools and career opportunities across the United States.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <a href="index.html">Home</a>
                    <a href="index.html">Trade Schools Map</a>
                    <a href="employer-hiring.html">For Employers</a>
                    <a href="submit-school.html">Submit School</a>
                </div>
                <div class="footer-section">
                    <h3>Resources</h3>
                    <a href="#">Career Guide</a>
                    <a href="#">Program Finder</a>
                    <a href="#">Financial Aid</a>
                    <a href="#">Contact Us</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 BOMForge. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <script>
        // Global variables
        let allSchools = [];
        let currentSchool = null;
        let map = null;
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadSchoolData();
        });
        
        // Load school data
        async function loadSchoolData() {
            try {
                // Load geocoded schools data
                const geoResponse = await fetch('/data/production/trade_schools_geocoded_fixed.csv');
                const geoText = await geoResponse.text();

                // Load matchmaking data for programs
                const matchResponse = await fetch('/data/production/matchmaking_index.csv');
                const matchText = await matchResponse.text();
                
                // Parse CSV data
                const geoData = Papa.parse(geoText, { header: true }).data;
                const matchData = Papa.parse(matchText, { header: true }).data;
                
                // Process and merge data
                processData(geoData, matchData);
                
                // Get school from URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                const schoolName = urlParams.get('name');
                const schoolState = urlParams.get('state');
                const schoolCity = urlParams.get('city');
                
                if (schoolName && schoolState && schoolCity) {
                    findAndDisplaySchool(schoolName, schoolState, schoolCity);
                } else {
                    showError();
                }
                
            } catch (error) {
                console.error('Error loading school data:', error);
                showError();
            }
        }
        
        // Process and merge data
        function processData(geoData, matchData) {
            // Group matchmaking data by institution
            const schoolPrograms = {};
            matchData.forEach(row => {
                const key = `${row['Institution Name']}_${row.State}_${row.City}`;
                if (!schoolPrograms[key]) {
                    schoolPrograms[key] = {
                        programs: [],
                        email: row['Contact Email'] || '',
                        website: row.Website || ''
                    };
                }
                if (row.program) {
                    schoolPrograms[key].programs.push(row.program);
                }
            });
            
            // Process geocoded schools
            allSchools = [];
            geoData.forEach(row => {
                if (row.geocoded === 'True' && row.lat && row.lon) {
                    const key = `${row['Institution Name']}_${row.State}_${row.City}`;
                    const programData = schoolPrograms[key] || { programs: [], email: '', website: '' };
                    
                    // Deduplicate programs
                    const uniquePrograms = [...new Set(programData.programs)];
                    
                    // Clean website URL
                    let cleanWebsite = programData.website || '';
                    if (cleanWebsite && cleanWebsite.endsWith('/')) {
                        cleanWebsite = cleanWebsite.slice(0, -1);
                    }
                    
                    allSchools.push({
                        name: row['Institution Name'],
                        state: row.State,
                        city: row.City,
                        lat: parseFloat(row.lat),
                        lon: parseFloat(row.lon),
                        programs: uniquePrograms,
                        website: cleanWebsite,
                        email: programData.email,
                        displayName: row.display_name || `${row['Institution Name']}, ${row.City}, ${row.State}`
                    });
                }
            });
            
            console.log(`Loaded ${allSchools.length} schools`);
        }
        
        // Find and display school
        function findAndDisplaySchool(name, state, city) {
            const school = allSchools.find(s => 
                s.name.toLowerCase() === decodeURIComponent(name).toLowerCase() &&
                s.state.toLowerCase() === decodeURIComponent(state).toLowerCase() &&
                s.city.toLowerCase() === decodeURIComponent(city).toLowerCase()
            );
            
            if (school) {
                currentSchool = school;
                displaySchool(school);
                updateSEO(school);
                initializeMap(school);
                loadRelatedSchools(school);
            } else {
                showError();
            }
        }
        
        // Display school information
        function displaySchool(school) {
            // Hide loading, show content
            document.getElementById('loading').style.display = 'none';
            document.getElementById('school-content').style.display = 'block';
            
            // Update school header
            document.getElementById('school-name').textContent = school.name;
            document.getElementById('location-text').textContent = `${school.city}, ${school.state}`;
            document.getElementById('breadcrumb-school').textContent = school.name;
            
            // Update map links with school name parameter
            const mapLink = document.getElementById('mapLink');
            const breadcrumbMapLink = document.getElementById('breadcrumbMapLink');
            if (mapLink) {
                mapLink.href = `index.html?school=${encodeURIComponent(school.name)}`;
            }
            if (breadcrumbMapLink) {
                breadcrumbMapLink.href = `index.html?school=${encodeURIComponent(school.name)}`;
            }
            
            // Update description
            const description = document.getElementById('school-description');
            if (school.programs.length > 0) {
                description.innerHTML = `
                    <p>${school.name} is a trade school located in ${school.city}, ${school.state}, offering specialized programs in ${school.programs.slice(0, 3).join(', ')}${school.programs.length > 3 ? ' and more' : ''}.</p>
                    <p>Our institution provides hands-on training and education to prepare students for successful careers in technical and trade fields.</p>
                `;
            } else {
                description.innerHTML = `
                    <p>${school.name} is a trade school located in ${school.city}, ${school.state}, providing quality education and training programs.</p>
                    <p>Our institution focuses on practical, hands-on learning to prepare students for successful careers in technical and trade fields.</p>
                `;
            }
            
            // Update contact information
            if (school.email) {
                document.getElementById('email-contact').style.display = 'flex';
                const emailLink = document.getElementById('email-link');
                emailLink.href = `mailto:${school.email}`;
                emailLink.textContent = school.email;
            }
            
            if (school.website) {
                document.getElementById('website-contact').style.display = 'flex';
                const websiteLink = document.getElementById('website-link');
                websiteLink.href = school.website;
                websiteLink.textContent = school.website.replace(/^https?:\/\//, '');
            }
            
            // Display programs
            displayPrograms(school.programs);
        }
        
        // Display programs
        function displayPrograms(programs) {
            const programsGrid = document.getElementById('programs-grid');
            programsGrid.innerHTML = '';
            
            if (programs.length === 0) {
                programsGrid.innerHTML = '<p style="color: #666; font-style: italic;">Program information not available.</p>';
                return;
            }
            
            programs.forEach(program => {
                const programCard = document.createElement('div');
                programCard.className = 'program-card';
                programCard.innerHTML = `
                    <div class="program-name">${program}</div>
                    <div class="program-description">
                        Comprehensive training program designed to provide students with the skills and knowledge needed for success in this field.
                    </div>
                `;
                programsGrid.appendChild(programCard);
            });
        }
        
        // Initialize map
        function initializeMap(school) {
            map = L.map('map-container').setView([school.lat, school.lon], 15);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);
            
            // Add marker for the school
            const marker = L.marker([school.lat, school.lon]).addTo(map);
            marker.bindPopup(`
                <div style="text-align: center;">
                    <h3 style="margin: 0 0 10px 0; color: #15202b;">${school.name}</h3>
                    <p style="margin: 0; color: #666;">${school.city}, ${school.state}</p>
                </div>
            `).openPopup();
        }
        
        // Load related schools
        function loadRelatedSchools(school) {
            const relatedSchools = allSchools
                .filter(s => s.state === school.state && s.name !== school.name)
                .slice(0, 6);
            
            const relatedGrid = document.getElementById('related-grid');
            relatedGrid.innerHTML = '';
            
            if (relatedSchools.length === 0) {
                relatedGrid.innerHTML = '<p style="color: #666; font-style: italic;">No similar schools found in this area.</p>';
                return;
            }
            
            relatedSchools.forEach(relatedSchool => {
                const relatedCard = document.createElement('div');
                relatedCard.className = 'related-card';
                relatedCard.onclick = () => {
                    window.location.href = `school-detail.html?name=${encodeURIComponent(relatedSchool.name)}&state=${encodeURIComponent(relatedSchool.state)}&city=${encodeURIComponent(relatedSchool.city)}`;
                };
                
                relatedCard.innerHTML = `
                    <div class="related-name">${relatedSchool.name}</div>
                    <div class="related-location">${relatedSchool.city}, ${relatedSchool.state}</div>
                    <div class="related-programs">${relatedSchool.programs.slice(0, 3).join(', ')}${relatedSchool.programs.length > 3 ? '...' : ''}</div>
                `;
                relatedGrid.appendChild(relatedCard);
            });
        }
        
        // Update SEO meta tags
        function updateSEO(school) {
            const baseUrl = window.location.origin;
            const schoolUrl = `${baseUrl}/school-detail.html?name=${encodeURIComponent(school.name)}&state=${encodeURIComponent(school.state)}&city=${encodeURIComponent(school.city)}`;
            
            // Update page title
            document.getElementById('page-title').textContent = `${school.name} | Trade School in ${school.city}, ${school.state} | BOMForge`;
            
            // Update meta description
            const description = `${school.name} in ${school.city}, ${school.state} offers trade programs including ${school.programs.slice(0, 3).join(', ')}. Find detailed information about programs, contact details, and location.`;
            document.getElementById('page-description').setAttribute('content', description);
            
            // Update keywords
            const keywords = `trade school, ${school.name}, ${school.city} ${school.state}, vocational training, ${school.programs.join(', ')}, career education, technical programs`;
            document.getElementById('page-keywords').setAttribute('content', keywords);
            
            // Update Open Graph tags
            document.getElementById('og-url').setAttribute('content', schoolUrl);
            document.getElementById('og-title').setAttribute('content', `${school.name} | Trade School in ${school.city}, ${school.state}`);
            document.getElementById('og-description').setAttribute('content', description);
            
            // Update Twitter tags
            document.getElementById('twitter-url').setAttribute('content', schoolUrl);
            document.getElementById('twitter-title').setAttribute('content', `${school.name} | Trade School in ${school.city}, ${school.state}`);
            document.getElementById('twitter-description').setAttribute('content', description);
            
            // Update canonical URL
            document.getElementById('canonical-url').setAttribute('href', schoolUrl);
            
            // Update structured data
            const structuredData = {
                "@context": "https://schema.org",
                "@type": "EducationalOrganization",
                "name": school.name,
                "description": description,
                "address": {
                    "@type": "PostalAddress",
                    "addressLocality": school.city,
                    "addressRegion": school.state,
                    "addressCountry": "US"
                },
                "url": school.website || schoolUrl,
                "sameAs": school.website ? [school.website] : []
            };
            
            if (school.email) {
                structuredData.email = school.email;
            }
            
            document.getElementById('structured-data').textContent = JSON.stringify(structuredData);
            
            // Update breadcrumb structured data
            const breadcrumbData = {
                "@context": "https://schema.org",
                "@type": "BreadcrumbList",
                "itemListElement": [
                    {
                        "@type": "ListItem",
                        "position": 1,
                        "name": "Home",
                        "item": `${baseUrl}/index.html`
                    },
                    {
                        "@type": "ListItem",
                        "position": 2,
                        "name": "Trade Schools Map",
                        "item": `${baseUrl}/map.html`
                    },
                    {
                        "@type": "ListItem",
                        "position": 3,
                        "name": school.name,
                        "item": schoolUrl
                    }
                ]
            };
            
            document.getElementById('breadcrumb-structured-data').textContent = JSON.stringify(breadcrumbData);
        }
        
        // Show error state
        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
        }
    </script>
</body>
</html>
